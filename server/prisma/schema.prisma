generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

// ===== BLOG MODELS =====

model BlogPost {
  id              String         @id @default(uuid())
  title           String         @db.VarChar(255)
  slug            String         @unique @db.VarChar(255)
  content         String         @db.Text
  excerpt         String?        @db.VarChar(500)
  featured_image  String?        @db.VarChar(500)
  status          PostStatus     @default(DRAFT)
  author_name     String         @db.VarChar(100)
  published_at    DateTime?
  view_count      Int            @default(0)

  category_id     String?
  category        BlogCategory?  @relation(fields: [category_id], references: [id], onDelete: SetNull)

  tags            BlogPostTag[]
  reactions       BlogReaction[]

  created_at      DateTime       @default(now())
  updated_at      DateTime       @updatedAt

  @@index([slug])
  @@index([status, published_at])
  @@index([category_id])
  @@map("blog_posts")
}

enum PostStatus {
  DRAFT
  PUBLISHED
  ARCHIVED
}

model BlogCategory {
  id          String     @id @default(uuid())
  name        String     @db.VarChar(100)
  slug        String     @unique @db.VarChar(100)
  description String?    @db.VarChar(500)
  color       String?    @db.VarChar(7)

  posts       BlogPost[]

  created_at  DateTime   @default(now())
  updated_at  DateTime   @updatedAt

  @@map("blog_categories")
}

model BlogTag {
  id         String        @id @default(uuid())
  name       String        @db.VarChar(50)
  slug       String        @unique @db.VarChar(50)

  posts      BlogPostTag[]

  created_at DateTime      @default(now())

  @@map("blog_tags")
}

model BlogPostTag {
  post_id String
  tag_id  String

  post    BlogPost @relation(fields: [post_id], references: [id], onDelete: Cascade)
  tag     BlogTag  @relation(fields: [tag_id], references: [id], onDelete: Cascade)

  @@id([post_id, tag_id])
  @@map("blog_post_tags")
}

model BlogReaction {
  id           String       @id @default(uuid())
  type         ReactionType
  session_id   String       @db.VarChar(100)

  post_id      String
  post         BlogPost     @relation(fields: [post_id], references: [id], onDelete: Cascade)

  created_at   DateTime     @default(now())

  @@unique([post_id, session_id])
  @@index([post_id])
  @@map("blog_reactions")
}

enum ReactionType {
  LIKE
  LOVE
  HELPFUL
}

// ===== REVIEW MODELS =====

model Review {
  id              String        @id @default(uuid())
  customer_name   String        @db.VarChar(100)
  customer_city   String?       @db.VarChar(100)
  customer_avatar String?       @db.VarChar(500)
  rating          Int           @db.TinyInt
  text            String        @db.Text
  car_make        String?       @db.VarChar(100)
  car_model       String?       @db.VarChar(100)
  car_year        Int?
  is_verified     Boolean       @default(false)
  is_published    Boolean       @default(true)
  photos          ReviewPhoto[]
  created_at      DateTime      @default(now())
  updated_at      DateTime      @updatedAt

  @@index([is_published, rating])
  @@index([created_at])
  @@map("reviews")
}

model ReviewPhoto {
  id         String   @id @default(uuid())
  url        String   @db.VarChar(500)
  alt_text   String?  @db.VarChar(255)
  sort_order Int      @default(0)
  review_id  String
  review     Review   @relation(fields: [review_id], references: [id], onDelete: Cascade)
  created_at DateTime @default(now())

  @@index([review_id])
  @@map("review_photos")
}

model CompletedDeal {
  id            String              @id @default(uuid())
  car_make      String              @db.VarChar(100)
  car_model     String              @db.VarChar(100)
  car_year      Int
  car_vin       String?             @db.VarChar(17)
  auction_price Decimal             @db.Decimal(10, 2)
  market_price  Decimal             @db.Decimal(10, 2)
  savings       Decimal             @db.Decimal(10, 2)
  delivery_city String?             @db.VarChar(100)
  description   String?             @db.Text
  is_published  Boolean             @default(true)
  photos        CompletedDealPhoto[]
  created_at    DateTime            @default(now())
  updated_at    DateTime            @updatedAt

  @@index([is_published, created_at])
  @@map("completed_deals")
}

model CompletedDealPhoto {
  id         String        @id @default(uuid())
  url        String        @db.VarChar(500)
  alt_text   String?       @db.VarChar(255)
  photo_type DealPhotoType @default(AFTER)
  sort_order Int           @default(0)
  deal_id    String
  deal       CompletedDeal @relation(fields: [deal_id], references: [id], onDelete: Cascade)
  created_at DateTime      @default(now())

  @@index([deal_id])
  @@map("completed_deal_photos")
}

enum DealPhotoType {
  BEFORE
  AFTER
}

// ===== ORDER TRACKING MODELS =====

model Order {
  id               String              @id @default(uuid())
  order_number     String              @unique @db.VarChar(20)
  tracking_code    String              @unique @db.VarChar(50)
  car_make         String              @db.VarChar(100)
  car_model        String              @db.VarChar(100)
  car_year         Int
  car_vin          String?             @db.VarChar(17)
  car_color        String?             @db.VarChar(50)
  car_image        String?             @db.VarChar(500)
  auction_price    Decimal?            @db.Decimal(10, 2)
  shipping_cost    Decimal?            @db.Decimal(10, 2)
  total_price      Decimal?            @db.Decimal(10, 2)
  customer_name    String              @db.VarChar(100)
  customer_phone   String?             @db.VarChar(20)
  customer_email   String?             @db.VarChar(255)
  status           OrderStatus         @default(WON)
  current_stage    Int                 @default(1)
  auction_source   String?             @db.VarChar(50)
  lot_number       String?             @db.VarChar(50)
  origin_port      String?             @db.VarChar(100)
  destination_port String?             @db.VarChar(100)
  vessel_name      String?             @db.VarChar(100)
  estimated_arrival DateTime?
  status_history   OrderStatusHistory[]
  created_at       DateTime            @default(now())
  updated_at       DateTime            @updatedAt

  @@index([order_number])
  @@index([tracking_code])
  @@index([status, created_at])
  @@index([customer_email])
  @@map("orders")
}

model OrderStatusHistory {
  id         String      @id @default(uuid())
  status     OrderStatus
  stage      Int
  note       String?     @db.Text
  location   String?     @db.VarChar(200)
  changed_by String?     @db.VarChar(100)
  order_id   String
  order      Order       @relation(fields: [order_id], references: [id], onDelete: Cascade)
  created_at DateTime    @default(now())

  @@index([order_id, created_at])
  @@map("order_status_history")
}

enum OrderStatus {
  WON
  PAID
  SHIPPING
  PORT
  DELIVERED
}
